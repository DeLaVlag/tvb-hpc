# TVB-HPC

This is a Python package for generating code for parameter sweeps and Bayesian
inversion.

## Docs

Sphinx-built docs are [here](https://the-virtual-brain.github.io/tvb-hpc).

A usuable API is forming: the following performs similar simulation
```python
import numpy as np
from tvb.simulator.lab import models, connectivity, simulator, coupling
from tvb_hpc.lab import HMJE, LinearCfun, DenseNetwork, timer, SimpleTimeStep

nnode = 1024
niter = 1000
weights = np.abs(np.random.randn(nnode, nnode))

# with code generated by tvb-hpc
model = HMJE()
cfun = LinearCfun(model)
net = DenseNetwork(model, cfun)
stepper = SimpleTimeStep(model, cfun, net)
stepper.prep_data(weights=weights)
stepper.run(n_iter=niter)

# with TVB
model = models.Epileptor()
linear = coupling.Linear()
conn = connectivity.Connectivity(speed=np.inf, weights=weights, delays=weights*0, centres=np.zeros((nnode, 3)))
sim = simulator.Simulator(connectivity=conn, model=model, coupling=linear)
sim.configure()
sim.run(simulation_length=sim.integrator.dt*niter)
```
with a hopefully better runtime,
```bash
$ TVB_LOG=INFO python example.py 
INFO:Linear<HMJE>:input shorter than obsrv, truncating obsrv used for cfun.
INFO:tvb_hpc.utils.timer:elapsed 2.125s
   INFO  log level set to INFO
   INFO  elapsed 43.655s
```

## Development

Current development is test-driven, so they are the best place
to see how things work and to start hacking. Run
```bash
TVB_LOG=DEBUG python3 -m unittest tvb_hpc.tests
```
Or a specific test,
```bash
TVB_LOG=DEBUG python3 -m unittest tvb_hpc.tests.TestScheme.test_euler
```
Decrease `TVB_LOG` to `INFO` if it's too verbose. Please also check style with
```
flake8 tvb_hpc
```

If you're going to commit and push, consider using the pre commit hooks
```bash
ln -s $(pwd)/{.pre-commit,.git/hooks/pre-commit}
```
